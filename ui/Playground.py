import sys

import streamlit as st
from streamlit.runtime import Runtime
from streamlit.web import cli as stcli

from ui.bot_container import bot_container
from app.app import app
from ui.sidebar import project_selection
from ui.utils.utils import disable_input_focusout

BOT_CONTAINER_WIDTH = 0.3


def playground():
    """Show the playground container"""
    st.set_page_config(layout="wide")
    with st.sidebar:
        project_selection()
    st.title('ðŸ“Š BESSER Conversational Data Analysis')
    st.subheader("ðŸ¤– Chat assistance")

    bot_col, dash_col = st.columns([BOT_CONTAINER_WIDTH, 1 - BOT_CONTAINER_WIDTH])
    with bot_col:
        bot_container()

    with dash_col:
        data_source = app.selected_project.data_sources[0]
        tab_data, tab_plot = st.tabs(['Data', 'Plot'])

        with tab_data:
            st.write(data_source.df)

        with tab_plot:
            if app.selected_project.plot:
                st.plotly_chart(app.selected_project.plot, use_container_width=True)
            else:
                st.info(
                    'Here you can view some graphical answers generated by the bot, like line charts or histograms.',
                    icon='ðŸ’¡'
                )


if __name__ == "__main__":

    if st.runtime.exists():
        playground()
        disable_input_focusout()

    else:
        sys.argv = ["streamlit", "run", sys.argv[0]]
        sys.exit(stcli.main())
